---
import Shell from "../../layouts/Shell.astro";
import ArticleHeader from "../../components/ArticleHeader.astro";
import { getEntry, getCollection, type CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const posts: CollectionEntry<"posts">[] = await getCollection("posts");
  return posts.map((post: CollectionEntry<"posts">) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props as { post: CollectionEntry<"posts"> };
const author = await getEntry(post.data.author);
const { Content } = await post.render();
---

<Shell title={`${post.data.title} Â· El Gallo Galante`} description={post.data.excerpt}>
  <article class="max-w-screen-xl mx-auto px-6">
    <ArticleHeader post={post} author={author} />

    <div class="max-w-2xl mx-auto">
      <div class="serif text-xl md:text-2xl leading-relaxed text-stone-800 space-y-8 whitespace-pre-line drop-cap">
        <Content />
      </div>

      <footer class="mt-24 pt-12 border-t border-stone-100 flex flex-col items-center gap-8">
        <div class="flex flex-col items-center gap-4 text-center max-w-sm">
          {author.data.photo && (
            <img src={author.data.photo} class="w-25 h-30 rounded-full grayscale mb-2" alt={author.data.name} />
          )}
          <h4 class="text-xs uppercase tracking-widest font-bold">Sobre el autor</h4>
          <p class="serif text-stone-500 italic">{author.data.bio}</p>
          <a
            href={`/autor/${author.slug}`}
            class="text-[10px] uppercase font-bold tracking-widest hover:text-stone-400 transition-colors"
          >
            Ver todos los textos de {author.data.name}
          </a>
        </div>
      </footer>
    </div>
  </article>
</Shell>
