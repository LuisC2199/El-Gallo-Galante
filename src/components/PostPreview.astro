---
import type { CollectionEntry } from "astro:content";

const { post, authorName, authorSlug } = Astro.props as {
  post: CollectionEntry<"posts">;
  authorName: string;
  authorSlug: string;
};

const categorySlug = post.data.category
  .toLowerCase()
  .normalize("NFD")
  .replace(/[\u0300-\u036f]/g, "");
---

<article class="group relative overflow-hidden rounded-xl h-[320px] md:h-[420px]">

  <!-- Background Image -->
  {post.data.coverImage && (
    <img
      src={post.data.coverImage}
      alt={post.data.title}
      class="absolute inset-0 w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700"
      loading="lazy"
    />
  )}

  <!-- Overlay -->
  <div class="absolute inset-0 bg-gradient-to-t from-black/75 via-black/30 to-black/10"></div>

  <!-- Category (Top Left) -->
  <div class="absolute top-6 left-6 md:top-8 md:left-8">
    <a
      href={`/categoria/${categorySlug}`}
      class="text-[10px] uppercase tracking-[0.3em] font-semibold bg-black/30 backdrop-blur-sm px-3 py-1 text-white hover:bg-black/50 transition"
    >
      {post.data.category}
    </a>
  </div>

  <!-- Center-Bottom Content -->
  <!-- Center-Bottom Content -->
  <div class="absolute bottom-0 left-0 right-0 p-8 md:p-14 text-white text-center md:text-left">
    <!-- Issue -->
    {post.data.issue && (
      <div class="text-[10px] uppercase tracking-[0.35em] text-white/70 mb-4">
        {post.data.issue
          .replace("ano-", "Año ")
          .replace("-numero-", " · Número ")
        }
      </div>
    )}

    <!-- Title -->
    <a href={`/posts/${post.slug}`}>
      <h3 class="display-serif text-3xl md:text-5xl font-medium leading-tight max-w-3xl mx-auto md:mx-0 group-hover:opacity-90 transition-opacity">
        {post.data.title}
      </h3>
    </a>

    <!-- Author -->
    <div class="mt-6">
      <a
        href={`/autor/${authorSlug}`}
        class="text-sm md:text-base tracking-wide text-white/85 hover:text-white transition-colors serif italic"
      >
        {authorName}
      </a>
    </div>

    {post.data.excerpt && (
      <p class="serif mt-6 text-base md:text-lg text-white/80 leading-relaxed max-w-2xl mx-auto md:mx-0">
        {post.data.excerpt}
      </p>
    )}
  </div>
</article>